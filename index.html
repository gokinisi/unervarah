<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nervarah – Daily Reminder</title>

  <!-- Firebase SDKs (paste your config below) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    const firebaseConfig = {
      // PASTE YOUR FULL CONFIG HERE (from Firebase console)
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.auth = auth;
    window.db = db;
  </script>

  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #f0f4ff, #e6e9ff);
      margin: 0;
      padding: 2rem 1rem;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      color: #1e293b;
    }
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      padding: 2.5rem;
      max-width: 600px;
      width: 100%;
    }
    h1 {
      text-align: center;
      color: #6366f1;
      margin-bottom: 0.5rem;
      font-size: 2.8rem;
    }
    .subtitle {
      text-align: center;
      color: #64748b;
      margin-bottom: 2rem;
      font-size: 1.2rem;
    }
    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.2rem;
      margin-bottom: 2rem;
    }
    .option-card {
      background: #ffffff;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s ease;
    }
    .option-card:hover {
      border-color: #6366f1;
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(99,102,241,0.15);
    }
    .option-card.selected {
      border-color: #6366f1;
      background: rgba(99,102,241,0.05);
    }
    .option-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #6366f1;
      margin: 0;
    }
    .consent-label {
      font-size: 0.95rem;
      color: #475569;
      margin: 1.5rem 0;
      line-height: 1.5;
    }
    .consent-label a {
      color: #6366f1;
      text-decoration: underline;
    }
    button {
      background: #6366f1;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 1rem;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: background 0.2s;
    }
    button:hover:not(:disabled) {
      background: #4f46e5;
    }
    button:disabled {
      background: #cbd5e1;
      cursor: not-allowed;
    }
    .daily-task {
      background: #ecfdf5;
      border: 1px solid #10b981;
      border-radius: 12px;
      padding: 2rem;
      margin-top: 1rem;
      text-align: center;
    }
    .daily-task h2 {
      color: #10b981;
      margin-bottom: 1.2rem;
    }
    .daily-task .instruction {
      font-size: 1.15rem;
      line-height: 1.6;
      white-space: pre-wrap;
      margin: 1.5rem 0;
      padding: 1.2rem;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 8px;
    }
    .change-category {
      margin-top: 2.5rem;
      text-align: center;
      font-size: 0.95rem;
      color: #64748b;
    }
    .change-category a {
      color: #6366f1;
      cursor: pointer;
      text-decoration: underline;
    }
    .footer {
      text-align: center;
      color: #94a3b8;
      margin-top: 2.5rem;
      font-size: 0.9rem;
    }
    .footer a {
      color: #64748b;
      text-decoration: none;
      margin: 0 0.5rem;
    }
    .error {
      color: #dc2626;
      text-align: center;
      margin-top: 1rem;
    }
    /* School dropdown styles */
    #schoolSection {
      margin: 1.5rem 0;
    }
    #schoolInput {
      width: 100%;
      padding: 0.8rem;
      font-size: 1rem;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      box-sizing: border-box;
    }
    #schoolResults {
      border: 1px solid #ddd;
      max-height: 220px;
      overflow-y: auto;
      border-radius: 8px;
      margin-top: 0.5rem;
      background: white;
      display: none;
    }
    #schoolResults div {
      padding: 10px;
      cursor: pointer;
    }
    #schoolResults div:hover {
      background: #f3f3f3;
    }
  </style>
</head>
<body>
  <div class="container" id="mainContainer"></div>

  <script type="module">
    const reminders = {
      "positive mindset": "Set a timer for 2 minutes. Breathe deeply and repeat: I am capable, and I am ready for the duration of two minutes.",
      "exercise boost": "Set a timer. Do as many push-ups or body weight squats as you can for 2 minutes.",
      "healthy relationship": "Text or call a loved one today just to share that you are thinking of that person— small moments matter.",
      "healthy eating motivation": "Today, eat some kind of lettuce greens before you eat anything else at lunch."
    };

    const universityMeetups = {
      "Alabama A&M University": {
        location: "University Commons Area / Quad (near Student Union & Wellness Center entrance)",
        day: "Every Thursday",
        time: "5:30 PM – 6:00 PM",
        note: "Quick 30-min check-in: Share your daily task progress, motivate each other, and plan ahead. Bring water or a mat if your goal involves movement! Informal, student-led."
      },
      // Add more as needed
    };

    const schools = [ /* your full list from before */ ];

    const container = document.getElementById('mainContainer');
    const today = new Date().toDateString();

    const auth = window.auth;
    const db = window.db;

    // Auth state listener
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        const profile = await loadProfile(user.uid);
        if (profile) {
          localStorage.setItem('nervarahCategory', profile.category);
          localStorage.setItem('nervarahUniversity', profile.university);
          showDailyTaskScreen(profile.category);
        } else {
          showSelectionScreen();
        }
      } else {
        showSignupScreen(); // Start with signup/login
      }
    });

    async function loadProfile(uid) {
      const q = query(collection(db, "users"), where("uid", "==", uid));
      const snapshot = await getDocs(q);
      if (!snapshot.empty) {
        return snapshot.docs[0].data();
      }
      return null;
    }

    async function saveProfile(uid, university, category) {
      await addDoc(collection(db, "users"), {
        uid,
        university,
        category,
        createdAt: serverTimestamp()
      });
    }

    function showSignupScreen() {
      container.innerHTML = `
        <h1>Sign Up</h1>
        <input type="text" id="name" placeholder="Name (optional)" />
        <input type="email" id="email" placeholder="school@email.edu" required>
        <input type="password" id="password" placeholder="Password" required>
        <button onclick="handleSignup()">Sign Up & Continue</button>
        <p>Have account? <a onclick="showLoginScreen()">Login</a></p>
        <div id="errorMsg" class="error"></div>
      `;
    }

    function showLoginScreen() {
      container.innerHTML = `
        <h1>Login</h1>
        <input type="email" id="email" placeholder="school@email.edu" required>
        <input type="password" id="password" placeholder="Password" required>
        <button onclick="handleLogin()">Login & Continue</button>
        <p>New? <a onclick="showSignupScreen()">Sign Up</a></p>
        <div id="errorMsg" class="error"></div>
      `;
    }

    async function handleSignup() {
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        await saveProfile(userCredential.user.uid, localStorage.getItem('nervarahUniversity'), localStorage.getItem('nervarahCategory'));
        showSelectionScreen();
      } catch (err) {
        document.getElementById('errorMsg').textContent = err.message;
      }
    }

    async function handleLogin() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        showSelectionScreen();
      } catch (err) {
        document.getElementById('errorMsg').textContent = err.message;
      }
    }

    // ... rest of your functions (showSelectionScreen, showSchoolSelectionScreen, showDailyTaskScreen, showMeetupsScreen) remain the same
    // Add log view in showDailyTaskScreen if needed
  </script>
</body>
</html>
